(()=>{"use strict";function e(e){const t=document.getElementById("debug");if(t){const s=`[${(new Date).toLocaleTimeString()}] ${e}`;t.textContent=s+"\n"+t.textContent}console.log(`[Contex.ly Popup] ${e}`)}function t(t,s){const n=document.getElementById("status");n&&(n.textContent=t,n.className=s?"success":"error",n.style.display="block",e(`Status: ${t} (${s?"success":"error"})`),setTimeout((()=>{n.style.display="none"}),3e3))}async function s(){e("Initializing popup");const s=document.getElementById("apiKey"),n=document.getElementById("saveButton");if(s&&n){try{e("Testing storage permission..."),await chrome.storage.sync.set({test:"test"}),await chrome.storage.sync.remove("test"),e("Storage permission test successful")}catch(s){return e(`Storage permission test failed: ${s.message}`),t("Storage permission not available",!1),void(n.disabled=!0)}try{e("Loading saved API key");const n=await chrome.storage.sync.get("openaiApiKey");n.openaiApiKey?(s.value=n.openaiApiKey,t("API key loaded",!0)):(e("No saved API key found"),t("Please enter your OpenAI API key",!1))}catch(s){e(`Error loading API key: ${s.message}`),t("Error loading API key",!1)}n.addEventListener("click",(async()=>{const o=s.value.trim();if(e("Save button clicked"),!o)return t("Please enter an API key",!1),void e("Empty API key attempted to save");n.disabled=!0;try{if(e("Saving API key"),await chrome.storage.sync.set({openaiApiKey:o}),(await chrome.storage.sync.get("openaiApiKey")).openaiApiKey!==o)throw new Error("API key verification failed");t("API key saved successfully!",!0),e("API key verified successfully")}catch(s){const n=s;e(`Error saving API key: ${n.message}`),t(`Error saving API key: ${n.message}`,!1)}finally{n.disabled=!1}}))}else e("ERROR: Could not find required DOM elements")}console.log("=== Contex.ly Popup Script Started ==="),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s()})();