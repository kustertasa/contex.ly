(()=>{"use strict";console.log("=== Contex.ly Background Script Started ==="),chrome.runtime.onInstalled.addListener((()=>{console.log("Extension installed or updated"),chrome.contextMenus.removeAll((()=>{chrome.contextMenus.create({id:"explain-selection",title:"🔍 Explain with Contex.ly",contexts:["selection"],enabled:!0},(()=>{chrome.runtime.lastError?console.error("Failed to create menu:",chrome.runtime.lastError):console.log("Menu created successfully")}))}))})),chrome.contextMenus.onClicked.addListener((async(e,t)=>{if(console.log("Menu click detected:",e.menuItemId),"explain-selection"===e.menuItemId&&e.selectionText){if(console.log("Contex.ly menu clicked with selection:",e.selectionText),!(null==t?void 0:t.id))return void console.error("No tab ID available");try{await chrome.scripting.executeScript({target:{tabId:t.id},files:["content.js"]}),console.log("Content script injected or already present")}catch(e){console.log("Content script injection error (might already be present):",e)}try{const o=await chrome.tabs.sendMessage(t.id,{type:"EXPLAIN_TEXT",text:e.selectionText});console.log("Message sent successfully, response:",o)}catch(o){console.error("Error sending message:",o);try{await chrome.scripting.executeScript({target:{tabId:t.id},func:e=>{const t=document.createElement("div");t.style.cssText="\n              position: fixed;\n              top: 20px;\n              right: 20px;\n              background: #f44336;\n              color: white;\n              padding: 10px;\n              border-radius: 4px;\n              z-index: 10000;\n              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            ",t.textContent="Error: Could not process the selected text. Please try reloading the page.",document.body.appendChild(t),setTimeout((()=>t.remove()),5e3)},args:[e.selectionText]})}catch(e){console.error("Failed to show fallback notification:",e)}}}}))})();